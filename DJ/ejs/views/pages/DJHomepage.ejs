<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="css/DJStyle.css">
        <title>DJHome</title>
        <style>
            .border .content #Week{
                padding: 20px;  
                background-color: #202122;
                margin-right: 300px;
                margin-left: 300px;
                margin-top: 40px;
                font-size: 30px;
                align-items: center;
            }

            .border .content #Week th{
                padding: 20px; 
                border: solid 2pt #a9a9a9; 
                background-color: #202122;
                margin-right: 40px;
                margin-left: 40px;
            }
            .border .content #Week tr{
                padding: 20px; 
                border: solid 2pt #a9a9a9; 
                background-color: #202122;
                margin-right: 40px;
                margin-left: 40px;
            }

            .border .content #Week td{
                padding: 20px; 
                border: solid 2pt #a9a9a9; 
                background-color: #202122;
                margin-right: 40px;
                margin-left: 40px;
                margin-bottom: 40px;
                height: 100px;
            }
            .border .content #Week caption{
                padding: 10px;
                font-size: 40px;
                background-color: #202122;
                margin-right: 40px;
                margin-left: 40px;
                margin-bottom: 40px;
                text-align: center;
            }
            .border .content #Week td #arrowr{
                padding: 10px; 
                border: solid;
                display: inline; 
                background-color: #202122;
                margin-right: 40px;
                margin-left: 40px;
                margin-bottom: 50px;
            }
            .border .content #Week td #arrowl{
                padding: 10px; 
                border: solid;
                display: inline; 
                background-color: #202122;
                margin-right: 40px;
                margin-left: 40px;
                margin-bottom: 50px;
            }
            .border .content #Week tr td #day1{
                padding: 5px; 
                border: none;
                background-color: #202122;
                margin-right: 1px;
                margin-left: 1px;
                font-size: 24px;
            }
            .border .content #Week tr td #day2{
                padding: 5px; 
                border: none;
                background-color: #202122;
                margin-right: 1px;
                margin-left: 1px;
                font-size: 24px;
            }
            .border .content #Week tr td #day3{
                padding: 5px; 
                border: none;
                background-color: #202122;
                margin-right: 1px;
                margin-left: 1px;
                font-size: 24px;
            }
            .border .content #Week tr td #day4{
                padding: 5px; 
                border: none;
                background-color: #202122;
                margin-right: 1px;
                margin-left: 1px;
                font-size: 24px;
            }
            .border .content #Week tr td #day5{
                padding: 5px; 
                border: none;
                background-color: #202122;
                margin-right: 1px;
                margin-left: 1px;
                font-size: 24px;
            }
            .border .content #Week tr td #day6{
                padding: 5px; 
                border: none;
                background-color: #202122;
                margin-right: 1px;
                margin-left: 1px;
                font-size: 24px;
            }
            .border .content #Week tr td #day7{
                padding: 5px; 
                border: none;
                background-color: #202122;
                margin-right: 1px;
                margin-left: 1px;
                font-size: 24px;
            }
            .border .content h1 {
                padding: 10px;  
                background-color: #202122;
                margin-top: 40px;
                margin-right: 1000px;
                margin-left: 1000px;
            }
            .border .content hr {
                color: #6699CC;
                margin-top: 40px;
                margin-bottom: 40px;
                margin-right: 850px;
                margin-left: 800px;
                text-align: center;
            }

            .border .content #timezone {
                padding: 10px; 
                border: solid;
                display: inline;
                align-items: center; 
                background-color: #202122;
                margin-right: 100px;
                margin-top: 40px;
                margin-left: 900px;
            }

            .border .content #date {
                padding: 10px; 
                border: solid;
                display: inline;
                align-items: center; 
                background-color: #202122;
                margin-right: 900px;
                margin-top: 40px;
                margin-left: 100px
            }

            .border .content #Timeslots {
                padding: 10px;  
                background-color: #202122;
                margin-right: 100px;
                margin-left: 100px;
                margin-top: 40px;
                max-height: 100px;
                height: 100px;
                max-width: 2200px;
                width: 2200px;
                align-items: center;
                border: solid;
                border-color: #a9a9a9;
                overflow-x: scroll;
                white-space: nowrap;
            }
            .border .content #Timeslots #timeslot {
                padding: 20px;  
                background-color: #202122;
                margin-right: 30px;
                margin-left: 30px;
                margin-top: 20px;
                align-items: center;
                border: solid;
            }
            .border .content dialog{
                border-color: #a9a9a9;
                background-color: #470202;
                margin-left: 20.5%;
                margin-top: 17%;
                width: 150px;
            }
        </style>
        <%- include('../partials/NavbarDjHome'); %>
    </head>
    <body>
        <div class="border"> 
            <main class = "content">
                <table id="Week">
                    <caption>Select Day of the week</caption>
                    <tr>
                        <th style="border:none;"></th>
                        <th>Sunday</th>
                        <th>Monday</th>
                        <th>Tuesday</th>
                        <th>Wednesday</th>
                        <th>Thursday</th>
                        <th>Friday</th>
                        <th>Saturday</th>
                        <th style="border:none;"></th>
                    </tr>
                    <tr>
                        <td style="border:none;font-size: 50px;"><button id="arrowl" onclick="leftW()"> &#8592 </button></td>
                        <td><button id="day1"> October 1st 2023</button></td>
                        <td><button id="day2"> October 2nd 2023</button></td>
                        <td><button id="day3"> October 3rd 2023</button></td>
                        <td><button id="day4"> October 4th 2023</button></td>
                        <td><button id="day5"> October 5th 2023</button></td>
                        <td><button id="day6"> October 6th 2023</button></td>
                        <td><button id="day7"> October 7th 2023</button></td>
                        <td style="border:none; font-size: 50px;"> <button id="arrowr" onclick="rightW()"> &#8594 </button></td>
                    </tr>
                </table>
                <h1>Select Time Slot</h1>
                <hr>
                <p id="timezone">TimeZone: U.S Eastern</p> 
                <p id="date">Date: None </p>
                <br>
                <section id="Timeslots">
                </section>            
            </main>
        </div>
        <script>
            let weekNumber = 1;
            let week = <%-JSON.stringify(ThisWeek)%>
            let dayVal = Object.values(week[0]);
            let day2Val = Object.values(week[1]);
            let day3Val = Object.values(week[2]);
            let day4Val = Object.values(week[3]);
            let day5Val = Object.values(week[4]);
            let day6Val = Object.values(week[5]);
            let day7Val = Object.values(week[6]);
            let d = document.getElementById("day1");
            d.innerHTML = dayVal[1];
            d.addEventListener("click",dayHandler);
            let d2 = document.getElementById("day2");
            d2.innerHTML = day2Val[1];
            d2.addEventListener("click",day2Handler);
            let d3 = document.getElementById("day3");
            d3.innerHTML = day3Val[1];
            d3.addEventListener("click",day3Handler);       
            let d4 = document.getElementById("day4");
            d4.innerHTML = day4Val[1];
            d4.addEventListener("click",day4Handler);
            let d5 = document.getElementById("day5");
            d5.innerHTML = day5Val[1];
            d5.addEventListener("click",day5Handler);
            let d6 = document.getElementById("day6");
            d6.innerHTML = day6Val[1];
            d6.addEventListener("click",day6Handler);
            let d7 = document.getElementById("day7");
            d7.innerHTML = day7Val[1];
            d7.addEventListener("click",day7Handler);
            console.log("here");
            
            async function leftW() {
                if(weekNumber == 1) {
                    weekNumber--;
                }
                const fetchPromise = fetch('http://localhost:8080/DJHomepage',{
                method: 'POST',
                cache: "no-store",
                headers:{
                    'Accept': 'application/json',
                   'Content-Type': 'application/json' 
                }, 
                body: JSON.stringify({
                    WeekNum: weekNumber,
                    page: 0,
                    Date: "",
                    Time: ""
                })
            });
            fetchPromise.then(function(response) {
                responseClone = response.clone();
                console.log(response);
                return response.json();
            }).then(function(data) {
                week = data.ThisWeek;
                changeData(week);
                console.log(data.ThisWeek);
            }, function(rejectionReason) { 
                console.log('Error parsing JSON from response:', rejectionReason, responseClone); 
                responseClone.text() 
                .then(function (bodyText) {
                    console.log('Received the following instead of valid JSON:', bodyText);
                });
            });
            window.location.reload(); 
            }

            function changeData(nweek) {
                //console.log(nweek);
                let dayVal = Object.values(nweek[0]);
                console.log(dayVal);
                d.innerHTML = dayVal[1];
                let day2Val = Object.values(nweek[1]);
                d2.innerHTML = day2Val[1];
                let day3Val = Object.values(nweek[2]);
                d3.innerHTML = day3Val[1];
                let day4Val = Object.values(nweek[3]);
                d4.innerHTML = day4Val[1];
                let day5Val = Object.values(nweek[4]);
                d5.innerHTML = day5Val[1];
                let day6Val = Object.values(nweek[5]);
                d6.innerHTML = day6Val[1];
                let day7Val = Object.values(nweek[6]);
                d7.innerHTML = day7Val[1];
                d.addEventListener("click",dayHandler);
                d2.addEventListener("click",day2Handler);
                d3.addEventListener("click",day3Handler);       
                d4.addEventListener("click",day4Handler);
                d5.addEventListener("click",day5Handler);
                d6.addEventListener("click",day6Handler);
                d7.addEventListener("click",day7Handler);
            }

            function rightW() {
                const fetchPromise = fetch('http://localhost:8080/DJHomepage',{
                method: 'POST',
                cache: "no-store",
                headers:{
                    'Accept': 'application/json',
                   'Content-Type': 'application/json' 
                }, 
                body: JSON.stringify({
                    WeekNum: weekNumber,
                    page: 0,
                    Date: "",
                    Time: ""
                })
            });
            fetchPromise.then(function(response) {
                responseClone = response.clone();
                console.log(response);
                return response.json();
            }).then(function(data) {
                week = data.ThisWeek;
                changeData(week);
                console.log(data.ThisWeek);
            }, function(rejectionReason) { 
                console.log('Error parsing JSON from response:', rejectionReason, responseClone); 
                responseClone.text() 
                .then(function (bodyText) {
                    console.log('Received the following instead of valid JSON:', bodyText);
                });
            });
            window.location.reload(); 
            }

            function dayHandler() {
                console.log(dayVal);
                let section = document.getElementById("Timeslots");
                document.getElementById("date").innerHTML = "Date: " + dayVal[1];
                while(section.firstElementChild) {
                    let child = section.firstElementChild;
                    section.removeChild(child);
                }
                for(let times of dayVal[4]) {
                    let tSlot = Object.values(times);
                    let timeSlot = document.createElement('BUTTON');
                    timeSlot.setAttribute('id', 'timeslot');
                    let time = document.createTextNode(tSlot[0]);
                    timeSlot.appendChild(time);
                    section.appendChild(timeSlot);
                }
                let timeButtons = document.querySelectorAll('#timeslot');
                timeButtons.forEach(addListen)
            }
            function day2Handler() {
                let section = document.getElementById("Timeslots");
                document.getElementById("date").innerHTML = "Date: " + day2Val[1];
                while(section.firstElementChild) {
                    let child = section.firstElementChild;
                    section.removeChild(child);
                }
                for(let times of day2Val[4]) {
                    let tSlot = Object.values(times);
                    let timeSlot = document.createElement('BUTTON');
                    timeSlot.setAttribute('id', 'timeslot');
                    let time = document.createTextNode(tSlot[0]);
                    timeSlot.appendChild(time);
                    section.appendChild(timeSlot);
                }
                let timeButtons = document.querySelectorAll('#timeslot');
                timeButtons.forEach(addListen)
            }
            function day3Handler() {
                let section = document.getElementById("Timeslots");
                document.getElementById("date").innerHTML = "Date: " + day3Val[1];
                while(section.firstElementChild) {
                    let child = section.firstElementChild;
                    section.removeChild(child);
                }
                for(let times of day3Val[4]) {
                    let tSlot = Object.values(times);
                    let timeSlot = document.createElement('BUTTON');
                    timeSlot.setAttribute('id', 'timeslot');
                    let time = document.createTextNode(tSlot[0]);
                    timeSlot.appendChild(time);
                    section.appendChild(timeSlot);
                }
                let timeButtons = document.querySelectorAll('#timeslot');
                timeButtons.forEach(addListen)
            }
            function day4Handler() {
                let section = document.getElementById("Timeslots");
                document.getElementById("date").innerHTML = "Date: " + day4Val[1];
                while(section.firstElementChild) {
                    let child = section.firstElementChild;
                    section.removeChild(child);
                }
                for(let times of day4Val[4]) {
                    let tSlot = Object.values(times);
                    let timeSlot = document.createElement('BUTTON');
                    timeSlot.setAttribute('id', 'timeslot');
                    let time = document.createTextNode(tSlot[0]);
                    timeSlot.appendChild(time);
                    section.appendChild(timeSlot);
                }
                let timeButtons = document.querySelectorAll('#timeslot');
                timeButtons.forEach(addListen)
            }
            function day5Handler() {
                let section = document.getElementById("Timeslots");
                document.getElementById("date").innerHTML = "Date: " + day5Val[1];
                while(section.firstElementChild) {
                    let child = section.firstElementChild;
                    section.removeChild(child);
                }
                for(let times of day5Val[4]) {
                    let tSlot = Object.values(times);
                    let timeSlot = document.createElement('BUTTON');
                    timeSlot.setAttribute('id', 'timeslot');
                    let time = document.createTextNode(tSlot[0]);
                    timeSlot.appendChild(time);
                    section.appendChild(timeSlot);
                }
                let timeButtons = document.querySelectorAll('#timeslot');
                timeButtons.forEach(addListen)
            }
            function day6Handler() {
                let section = document.getElementById("Timeslots");
                document.getElementById("date").innerHTML = "Date: " + day6Val[1];
                while(section.firstElementChild) {
                    let child = section.firstElementChild;
                    section.removeChild(child);
                }
                for(let times of day6Val[4]) {
                    let tSlot = Object.values(times);
                    let timeSlot = document.createElement('BUTTON');
                    timeSlot.setAttribute('id', 'timeslot');
                    let time = document.createTextNode(tSlot[0]);
                    timeSlot.appendChild(time);
                    section.appendChild(timeSlot);
                }
                let timeButtons = document.querySelectorAll('#timeslot');
                timeButtons.forEach(addListen)
            }
            function day7Handler() {
                let section = document.getElementById("Timeslots");
                document.getElementById("date").innerHTML = "Date: " + day7Val[1];
                while(section.firstElementChild) {
                    let child = section.firstElementChild;
                    section.removeChild(child);
                }
                for(let times of day7Val[4]) {
                    let tSlot = Object.values(times);
                    let timeSlot = document.createElement('BUTTON');
                    timeSlot.setAttribute('id', 'timeslot');
                    let time = document.createTextNode(tSlot[0]);
                    timeSlot.appendChild(time);
                    section.appendChild(timeSlot);
                }
                let timeButtons = document.querySelectorAll('#timeslot');
                timeButtons.forEach(addListen)
            }
            
            function addListen(time) {
                let timeS = time.innerHTML;
                time.addEventListener("click",() => pageNext(timeS))
            }

            function pageNext(times) {  
                let ref = 'DJTimeSlot';
                let da = "";
                da+= document.getElementById("date").innerHTML;
                let dateA = da.split(": ");
                let date = dateA[1];
                const fetchPromise = fetch('http://localhost:8080/DJHomepage',{
                method: 'POST',
                cache: "no-store",
                headers:{
                    'Accept': 'application/json',
                   'Content-Type': 'application/json' 
                }, 
                body: JSON.stringify({
                    WeekNum: weekNumber,
                    page: 1,
                    Date: date,
                    Time: times
                })
            });
            fetchPromise.then(function(response) {
                responseClone = response.clone();
                console.log(response);
                return response.json();
            }).then(function(data) {
                console.log(data.ThisDate);
                window.location.href=ref; 
            }, function(rejectionReason) { 
                console.log('Error parsing JSON from response:', rejectionReason, responseClone); 
                responseClone.text() 
                .then(function (bodyText) {
                    console.log('Received the following instead of valid JSON:', bodyText);
                });
            });  
            }
            </script>
    </body>
</html>