<!DOCTYPE html>
<html lang="en">
    <head>
        <title>DJHome</title>
        <style>
            * {
                margin: 0;
                color: #6699CC;
                background-color: #202122;
                flex-wrap: nowrap;
            }
            ::-webkit-scrollbar {
                -webkit-appearance: none;
                width: 15px;
            }
            ::-webkit-scrollbar-thumb {
                background:#6699CC;
            }

            ::-webkit-scrollbar-track {
                background-color:#202122;
            }
            .navbar {
                padding: 20px;
                display: flex;
                align-items: center;
                max-width: 2400px;
                max-height: 10%;
                min-width: 500px;
                margin: 0 auto;
                border-bottom: 5px solid black;
                border-left: 5px solid black;
                border-top: 5px solid black;
                border-right: 5px solid black;
                background-color: #202122;
                margin-top: 1%;
                margin-bottom: 1%;
                position: relative;
            }
            .navbar h1 {
                color: #6699CC;
                background-color: #202122;
                margin-bottom: 10px;
                margin-left: 600px;
                font-size: 50px;
                text-align: center;
            }
            .navbar .Producer {
                padding: 10px; border: solid; background-color: #202122;
                margin-right: 40px;
                margin-left: 40px;
            }

            .navbar .Listener {
                padding: 10px; border: solid; background-color: #202122;
                margin-right: 40px;
                margin-left: 40px;
            }

            .navbar .Dj {
                padding: 10px; 
                border: solid; 
                background-color: #202122;
                margin-right: 40px;
                margin-left: 40px;
                flex-wrap: nowrap;
            }

            .border {
                padding: 20px;
                display: flex;
                align-items: top;
                max-width: 2400px;
                width: 2400px;
                max-height: 2000px;
                height: 1000px;
                margin: 0 auto;
                border-bottom: 10px solid black;
                border-left: 10px solid black;
                border-top: 10px solid black;
                border-right: 10px solid black;
                background-color: #202122;
                position: relative;
            }
            .border .content{
                background-color: #202122;
                width: 2400px;   
            }
            .border .content #Week{
                padding: 20px;  
                background-color: #202122;
                margin-right: 300px;
                margin-left: 300px;
                margin-top: 40px;
                font-size: 30px;
                align-items: center;
            }

            .border .content #Week th{
                padding: 20px; 
                border: solid 2pt #a9a9a9; 
                background-color: #202122;
                margin-right: 40px;
                margin-left: 40px;
            }
            .border .content #Week tr{
                padding: 20px; 
                border: solid 2pt #a9a9a9; 
                background-color: #202122;
                margin-right: 40px;
                margin-left: 40px;
            }

            .border .content #Week td{
                padding: 20px; 
                border: solid 2pt #a9a9a9; 
                background-color: #202122;
                margin-right: 40px;
                margin-left: 40px;
                margin-bottom: 40px;
                height: 100px;
            }
            .border .content #Week caption{
                padding: 10px;
                font-size: 40px;
                background-color: #202122;
                margin-right: 40px;
                margin-left: 40px;
                margin-bottom: 40px;
                text-align: center;
            }
            .border .content #Week td #arrowr{
                padding: 10px; 
                border: solid;
                display: inline; 
                background-color: #202122;
                margin-right: 40px;
                margin-left: 40px;
                margin-bottom: 50px;
            }
            .border .content #Week td #arrowl{
                padding: 10px; 
                border: solid;
                display: inline; 
                background-color: #202122;
                margin-right: 40px;
                margin-left: 40px;
                margin-bottom: 50px;
            }
            .border .content #Week tr td #day1{
                padding: 5px; 
                border: none;
                background-color: #202122;
                margin-right: 1px;
                margin-left: 1px;
                font-size: 24px;
            }
            .border .content #Week tr td #day2{
                padding: 5px; 
                border: none;
                background-color: #202122;
                margin-right: 1px;
                margin-left: 1px;
                font-size: 24px;
            }
            .border .content #Week tr td #day3{
                padding: 5px; 
                border: none;
                background-color: #202122;
                margin-right: 1px;
                margin-left: 1px;
                font-size: 24px;
            }
            .border .content #Week tr td #day4{
                padding: 5px; 
                border: none;
                background-color: #202122;
                margin-right: 1px;
                margin-left: 1px;
                font-size: 24px;
            }
            .border .content #Week tr td #day5{
                padding: 5px; 
                border: none;
                background-color: #202122;
                margin-right: 1px;
                margin-left: 1px;
                font-size: 24px;
            }
            .border .content #Week tr td #day6{
                padding: 5px; 
                border: none;
                background-color: #202122;
                margin-right: 1px;
                margin-left: 1px;
                font-size: 24px;
            }
            .border .content #Week tr td #day7{
                padding: 5px; 
                border: none;
                background-color: #202122;
                margin-right: 1px;
                margin-left: 1px;
                font-size: 24px;
            }
            .border .content h1 {
                padding: 10px;  
                background-color: #202122;
                margin-top: 40px;
                margin-right: 1000px;
                margin-left: 1000px;
            }
            .border .content hr {
                color: #6699CC;
                margin-top: 40px;
                margin-bottom: 40px;
                margin-right: 850px;
                margin-left: 800px;
                text-align: center;
            }

            .border .content #timezone {
                padding: 10px; 
                border: solid;
                display: inline;
                align-items: center; 
                background-color: #202122;
                margin-right: 100px;
                margin-top: 40px;
                margin-left: 900px;
            }

            .border .content #date {
                padding: 10px; 
                border: solid;
                display: inline;
                align-items: center; 
                background-color: #202122;
                margin-right: 900px;
                margin-top: 40px;
                margin-left: 100px
            }

            .border .content #Timeslots {
                padding: 10px;  
                background-color: #202122;
                margin-right: 100px;
                margin-left: 100px;
                margin-top: 40px;
                max-height: 100px;
                height: 100px;
                max-width: 2200px;
                width: 2200px;
                align-items: center;
                border: solid;
                border-color: #a9a9a9;
                overflow-x: scroll;
                white-space: nowrap;
            }
            .border .content #Timeslots #timeslot {
                padding: 20px;  
                background-color: #202122;
                margin-right: 30px;
                margin-left: 30px;
                margin-top: 20px;
                align-items: center;
                border: solid;
            }
            .border .content dialog{
                border-color: #a9a9a9;
                background-color: #470202;
                margin-left: 20.5%;
                margin-top: 17%;
                width: 150px;
            }
        </style>
        <nav class = "navbar">
            <div class = "Producer">
                <a href="/ProducerPage" >Producer</a> 
            </div>
            <div class = "Dj" style="width: 50px;text-align: center;">
                <a href="/DJHomepage">DJ</a>
            </div>
            <div class = "Listener">
                <a href="/listener_main" >Listener</a>
            </div>
            <h1> DJ Home </h1>
        </nav>
    </head>
    <body>
        <div class="border"> 
            <main class = "content">
                <table id="Week">
                    <caption>Select Day of the week</caption>
                    <tr>
                        <th style="border:none;"></th>
                        <th>Sunday</th>
                        <th>Monday</th>
                        <th>Tuesday</th>
                        <th>Wednesday</th>
                        <th>Thursday</th>
                        <th>Friday</th>
                        <th>Saturday</th>
                        <th style="border:none;"></th>
                    </tr>
                    <tr>
                        <td style="border:none;font-size: 50px;"><button id="arrowl" onclick="leftW()"> &#8592 </button></td>
                        <td><button id="day1"> October 1st 2023</button></td>
                        <td><button id="day2"> October 2nd 2023</button></td>
                        <td><button id="day3"> October 3rd 2023</button></td>
                        <td><button id="day4"> October 4th 2023</button></td>
                        <td><button id="day5"> October 5th 2023</button></td>
                        <td><button id="day6"> October 6th 2023</button></td>
                        <td><button id="day7"> October 7th 2023</button></td>
                        <td style="border:none; font-size: 50px;"> <button id="arrowr" onclick="rightW()"> &#8594 </button></td>
                    </tr>
                </table>
                <h1>Select Time Slot</h1>
                <hr>
                <p id="timezone">TimeZone: U.S Eastern</p> 
                <p id="date">Date: None </p>
                <br>
                <section id="Timeslots">
                </section>            
            </main>
        </div>
        <script>
            let week = <%-JSON.stringify(ThisWeek)%>
            let day1 = [];
            let day2 = [];
            let day3 = [];
            let day4 = [];
            let day5 = [];
            let day6 = [];
            let day7 = [];
            let firstLoop = 1;
            let weekNumber = 0;
            console.log(week);
            for(let dayO of week) {
                console.log(dayO);
                //let day = Object.values(dayO);

                console.log(dayO.Playlists);
                if(firstLoop == 1) {
                    weekNumber = dayO.WeekNum;
                    console.log(weekNumber);
                    firstLoop = 0;
                }
                if(dayO.DayNum == 0) {
                    day1.push(dayO);
                }
                else if(dayO.DayNum == 1) {
                    day2.push(dayO);
                }
                else if(dayO.DayNum == 2) {
                    day3.push(dayO);
                }
                else if(dayO.DayNum == 3) {
                    day4.push(dayO);
                }
                else if(dayO.DayNum == 4) {
                    day5.push(dayO);
                }
                else if(dayO.DayNum == 5) {
                    day6.push(dayO);
                }
                else if(dayO.DayNum == 6) {
                    day7.push(dayO);
                }
            }
            console.log(day1);
            let d = document.getElementById("day1");
            d.innerHTML = day1[0].Date;
            d.addEventListener("click",dayHandler);
            let d2 = document.getElementById("day2");
            d2.innerHTML = day2[0].Date;
            d2.addEventListener("click",day2Handler);
            let d3 = document.getElementById("day3");
            d3.innerHTML = day3[0].Date;
            d3.addEventListener("click",day3Handler);       
            let d4 = document.getElementById("day4");
            d4.innerHTML = day4[0].Date;
            d4.addEventListener("click",day4Handler);
            let d5 = document.getElementById("day5");
            d5.innerHTML = day5[0].Date;
            d5.addEventListener("click",day5Handler);
            let d6 = document.getElementById("day6");
            d6.innerHTML = day6[0].Date;
            d6.addEventListener("click",day6Handler);
            let d7 = document.getElementById("day7");
            d7.innerHTML = day7[0].Date;
            d7.addEventListener("click",day7Handler);
            
            async function leftW() {
                weekNumber--;            
                const fetchPromise = fetch('http://localhost:8080/DJHomepage',{
                method: 'POST',
                cache: "no-store",
                headers:{
                    'Accept': 'application/json',
                   'Content-Type': 'application/json' 
                }, 
                body: JSON.stringify({
                    WeekNum: weekNumber,
                    page: 0,
                    Date: "",
                    Time: ""
                })
            });
            fetchPromise.then(function(response) {
                responseClone = response.clone();
                console.log(response);
                return response.json();
            }).then(function(data) {
                week = data.ThisWeek;
                changeData(week);
                console.log(data.ThisWeek);
            }, function(rejectionReason) { 
                console.log('Error parsing JSON from response:', rejectionReason, responseClone); 
                responseClone.text() 
                .then(function (bodyText) {
                    console.log('Received the following instead of valid JSON:', bodyText);
                });
            });
            window.location.reload(); 
            }

            function changeData(nweek) {
                day1 = [];
                day2 = [];
                day3 = [];
                day4 = [];
                day5 = [];
                day6 = [];
                day7 = [];
                for(let dayO of nweek) {
                    //console.log(dayO);
                    console.log(dayO.Date);
                    let day = Object.values(dayO);
                    //console.log(day);
                    if(day[4] == 0) {
                        day1.push(day);
                    }
                    else if(day[4] == 1) {
                        day2.push(day);
                    }
                    else if(day[4] == 2) {
                        day3.push(day);
                    }
                    else if(day[4] == 3) {
                        day4.push(day);
                    }
                    else if(day[4] == 4) {
                        day5.push(day);
                    }
                    else if(day[4] == 5) {
                        day6.push(day);
                    }
                    else if(day[4] == 6) {
                        day7.push(day);
                    }
                }
                d.innerHTML = day1[0][2];
                d2.innerHTML = day2[0][2];
                d3.innerHTML = day3[0][2];
                d4.innerHTML = day4[0][2];
                d5.innerHTML = day5[0][2];
                d6.innerHTML = day6[0][2];
                d7.innerHTML = day7[0][2];
                d.addEventListener("click",dayHandler);
                d2.addEventListener("click",day2Handler);
                d3.addEventListener("click",day3Handler);       
                d4.addEventListener("click",day4Handler);
                d5.addEventListener("click",day5Handler);
                d6.addEventListener("click",day6Handler);
                d7.addEventListener("click",day7Handler);
            }

            function rightW() {
                weekNumber++;
                const fetchPromise = fetch('http://localhost:8080/DJHomepage',{
                method: 'POST',
                cache: "no-store",
                headers:{
                    'Accept': 'application/json',
                   'Content-Type': 'application/json' 
                }, 
                body: JSON.stringify({
                    WeekNum: weekNumber,
                    page: 0,
                    Date: "",
                    Time: ""
                })
            });
            fetchPromise.then(function(response) {
                responseClone = response.clone();
                console.log(response);
                return response.json();
            }).then(function(data) {
                week = data.ThisWeek;
                changeData(week);
                console.log(data.ThisWeek);
            }, function(rejectionReason) { 
                console.log('Error parsing JSON from response:', rejectionReason, responseClone); 
                responseClone.text() 
                .then(function (bodyText) {
                    console.log('Received the following instead of valid JSON:', bodyText);
                });
            });
            window.location.reload(); 
            }

            function dayHandler() {
                console.log(day1);
                let section = document.getElementById("Timeslots");
                document.getElementById("date").innerHTML = "Date: " + day1[0].Date;
                while(section.firstElementChild) {
                    let child = section.firstElementChild;
                    section.removeChild(child);
                }
                for(let times of day1) { 
                    let timeSlot = document.createElement('BUTTON');
                    timeSlot.setAttribute('id', 'timeslot');
                    let time = document.createTextNode(times.Time);
                    timeSlot.appendChild(time);
                    section.appendChild(timeSlot);
                }
                let timeButtons = document.querySelectorAll('#timeslot');
                timeButtons.forEach(addListen)
            }
            function day2Handler() {
                console.log(day2);
                let section = document.getElementById("Timeslots");
                document.getElementById("date").innerHTML = "Date: " + day2[0].Date;
                while(section.firstElementChild) {
                    let child = section.firstElementChild;
                    section.removeChild(child);
                }
                for(let times of day2) { 
                    let timeSlot = document.createElement('BUTTON');
                    timeSlot.setAttribute('id', 'timeslot');
                    let time = document.createTextNode(times.Time);
                    timeSlot.appendChild(time);
                    section.appendChild(timeSlot);
                }
                let timeButtons = document.querySelectorAll('#timeslot');
                timeButtons.forEach(addListen)
            }
            function day3Handler() {
                console.log(day3);
                let section = document.getElementById("Timeslots");
                document.getElementById("date").innerHTML = "Date: " + day3[0].Date;
                while(section.firstElementChild) {
                    let child = section.firstElementChild;
                    section.removeChild(child);
                }
                for(let times of day3) { 
                    let timeSlot = document.createElement('BUTTON');
                    timeSlot.setAttribute('id', 'timeslot');
                    let time = document.createTextNode(times.Time);
                    timeSlot.appendChild(time);
                    section.appendChild(timeSlot);
                }
                let timeButtons = document.querySelectorAll('#timeslot');
                timeButtons.forEach(addListen)
            }
            function day4Handler() {
                console.log(day4);
                let section = document.getElementById("Timeslots");
                document.getElementById("date").innerHTML = "Date: " + day4[0].Date;
                while(section.firstElementChild) {
                    let child = section.firstElementChild;
                    section.removeChild(child);
                }
                for(let times of day4) { 
                    let timeSlot = document.createElement('BUTTON');
                    timeSlot.setAttribute('id', 'timeslot');
                    let time = document.createTextNode(times.Time);
                    timeSlot.appendChild(time);
                    section.appendChild(timeSlot);
                }
                let timeButtons = document.querySelectorAll('#timeslot');
                timeButtons.forEach(addListen)
            }
            function day5Handler() {
                console.log(day5);
                let section = document.getElementById("Timeslots");
                document.getElementById("date").innerHTML = "Date: " + day5[0].Date;
                while(section.firstElementChild) {
                    let child = section.firstElementChild;
                    section.removeChild(child);
                }
                for(let times of day5) { 
                    let timeSlot = document.createElement('BUTTON');
                    timeSlot.setAttribute('id', 'timeslot');
                    let time = document.createTextNode(times.Time);
                    timeSlot.appendChild(time);
                    section.appendChild(timeSlot);
                }
                let timeButtons = document.querySelectorAll('#timeslot');
                timeButtons.forEach(addListen)
            }
            function day6Handler() {
                console.log(day6);
                let section = document.getElementById("Timeslots");
                document.getElementById("date").innerHTML = "Date: " + day6[0].Date;
                while(section.firstElementChild) {
                    let child = section.firstElementChild;
                    section.removeChild(child);
                }
                for(let times of day6) { 
                    let timeSlot = document.createElement('BUTTON');
                    timeSlot.setAttribute('id', 'timeslot');
                    let time = document.createTextNode(times.Time);
                    timeSlot.appendChild(time);
                    section.appendChild(timeSlot);
                }
                let timeButtons = document.querySelectorAll('#timeslot');
                timeButtons.forEach(addListen)
            }
            function day7Handler() {
                console.log(day7);
                let section = document.getElementById("Timeslots");
                document.getElementById("date").innerHTML = "Date: " + day7[0].Date;
                while(section.firstElementChild) {
                    let child = section.firstElementChild;
                    section.removeChild(child);
                }
                for(let times of day7) { 
                    let timeSlot = document.createElement('BUTTON');
                    timeSlot.setAttribute('id', 'timeslot');
                    let time = document.createTextNode(times.Time);
                    timeSlot.appendChild(time);
                    section.appendChild(timeSlot);
                }
                let timeButtons = document.querySelectorAll('#timeslot');
                timeButtons.forEach(addListen)
            }
            
            function addListen(time) {
                let timeS = time.innerHTML;
                time.addEventListener("click",() => pageNext(timeS))
            }

            function pageNext(times) {  
                let ref = 'DJTimeSlot';
                let da = "";
                da+= document.getElementById("date").innerHTML;
                let dateA = da.split(": ");
                let date = dateA[1];
                const fetchPromise = fetch('http://localhost:8080/DJHomepage',{
                method: 'POST',
                cache: "no-store",
                headers:{
                    'Accept': 'application/json',
                   'Content-Type': 'application/json' 
                }, 
                body: JSON.stringify({
                    WeekNum: weekNumber,
                    page: 1,
                    Date: date,
                    Time: times
                })
            });
            fetchPromise.then(function(response) {
                responseClone = response.clone();
                console.log(response);
                return response.json();
            }).then(function(data) {
                console.log(data.ThisDate);
                window.location.href=ref; 
            }, function(rejectionReason) { 
                console.log('Error parsing JSON from response:', rejectionReason, responseClone); 
                responseClone.text() 
                .then(function (bodyText) {
                    console.log('Received the following instead of valid JSON:', bodyText);
                });
            });  
            }
            </script>
    </body>
</html>